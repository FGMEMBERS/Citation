<?xml version="1.0"?>

<PropertyList>

  <!-- Suppliers are defined in Citation-II-common.xml -->
  <!-- power to buses -->

  <filter>
    <type>gain</type>
    <input>
      <condition>
	<greater-than>
	  <property>controls/electric/battery-bus-switch</property>
	  <value>0.5</value>
	</greater-than>
      </condition>
      <property>systems/electrical/outputs/bus/battery-hot</property>
    </input>
    <output>
      <property>systems/electrical/outputs/bus/battery</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
	<not>
	  <equals>
	    <property>controls/electric/battery-bus-switch</property>
	    <value>0</value>
	  </equals>
	</not>
	<property>controls/electric/circuit-breakers/bus-battery-hot/cb-emer-power</property>
      </condition>
      <property>systems/electrical/outputs/bus/battery-hot</property>
    </input>
    <output>
      <property>systems/electrical/outputs/bus/emer</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
	<and>
	  <or>
	    <property>controls/electric/circuit-breakers/cb-bus-left-1</property>
	    <property>controls/electric/circuit-breakers/cb-bus-left-2</property>
	    <property>controls/electric/circuit-breakers/cb-bus-left-3</property>
	  </or>
	  <greater-than>
	    <property>systems/electrical/outputs/suppliers/alternator</property>
	    <property>systems/electrical/outputs/bus/battery</property>
	  </greater-than>
	</and>
      </condition>
      <property>systems/electrical/outputs/suppliers/alternator</property>
    </input>
    <input>
      <condition>
	<and>
	  <or>
	    <property>controls/electric/circuit-breakers/cb-bus-left-1</property>
	    <property>controls/electric/circuit-breakers/cb-bus-left-2</property>
	    <property>controls/electric/circuit-breakers/cb-bus-left-3</property>
	  </or>
	  <greater-than>
	    <property>systems/electrical/outputs/suppliers/alternator[1]</property>
	    <property>systems/electrical/outputs/bus/battery</property>
	  </greater-than>
	</and>
      </condition>
      <property>systems/electrical/outputs/suppliers/alternator[1]</property>
    </input>
    <input>
      <condition>
	<and>
	  <greater-than>
	    <property>controls/electric/battery-bus-switch</property>
	    <value>0.5</value>
	  </greater-than>
	  <or>
	    <property>controls/electric/circuit-breakers/cb-bus-left-1</property>
	    <property>controls/electric/circuit-breakers/cb-bus-left-2</property>
	    <property>controls/electric/circuit-breakers/cb-bus-left-3</property>
	  </or>
	</and>
      </condition>
      <property>systems/electrical/outputs/suppliers/battery</property>
    </input>
    <output>
      <property>systems/electrical/outputs/bus/left</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
	<and>
	  <or>
	    <property>controls/electric/circuit-breakers/cb-bus-right-1</property>
	    <property>controls/electric/circuit-breakers/cb-bus-right-2</property>
	    <property>controls/electric/circuit-breakers/cb-bus-right-3</property>
	  </or>
	  <greater-than>
	    <property>systems/electrical/outputs/suppliers/alternator</property>
	    <property>systems/electrical/outputs/bus/battery</property>
	  </greater-than>
	</and>
      </condition>
      <property>systems/electrical/outputs/suppliers/alternator</property>
    </input>
    <input>
      <condition>
	<and>
	  <or>
	    <property>controls/electric/circuit-breakers/cb-bus-right-1</property>
	    <property>controls/electric/circuit-breakers/cb-bus-right-2</property>
	    <property>controls/electric/circuit-breakers/cb-bus-right-3</property>
	  </or>
	  <greater-than>
	    <property>systems/electrical/outputs/suppliers/alternator[1]</property>
	    <property>systems/electrical/outputs/bus/battery</property>
	  </greater-than>
	</and>
      </condition>
      <property>systems/electrical/outputs/suppliers/alternator[1]</property>
    </input>
    <input>
      <condition>
	<and>
          <greater-than>
	    <property>controls/electric/battery-bus-switch</property>
	    <value>0.5</value>
	  </greater-than>
	  <or>
	    <property>controls/electric/circuit-breakers/cb-bus-right-1</property>
	    <property>controls/electric/circuit-breakers/cb-bus-right-2</property>
	    <property>controls/electric/circuit-breakers/cb-bus-right-3</property>
	  </or>
	</and>
      </condition>
      <property>systems/electrical/outputs/suppliers/battery</property>
    </input>
    <output>
      <property>systems/electrical/outputs/bus/right</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
	<and>
	  <greater-than>
	    <property>systems/electrical/outputs/bus/right</property>
	    <value>1</value>
	  </greater-than>
	  <property>controls/electric/circuit-breakers/bus-right/cb-ac-gpws</property>
	</and>
      </condition>
      <property>systems/electrical/outputs/bus/right</property>
    </input>
    <output>
      <property>/systems/electrical/outputs/mk-viii</property>
    </output>
  </filter>

<!--
##################
####  LIGHTS  ####
##################
  -->

  <!-- circumvent odd nasal program which controls beacon operation -->
  <filter>
    <type>gain</type>
    <input>
      <condition>
	<and>
	  <property>controls/electric/circuit-breakers/bus-left/cb-light-beacon</property>
	  <property>controls/lighting/beacon-switch</property>
	  <greater-than>
	    <property>systems/electrical/outputs/bus/left</property>
	    <value>20</value>
	  </greater-than>
	</and>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/lighting/beacon</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
	<and>
	  <property>controls/lighting/landing-light-switch</property>
	  <property>controls/electric/circuit-breakers/bus-left/cb-light-landing-left</property>
	  <greater-than>
	    <property>systems/electrical/outputs/bus/left</property>
	    <value>20</value>
	  </greater-than>
	</and>
      </condition>
      <value>1</value>
    </input>
    <input>
      <value>0</value>
    </input>
    <output>
      <property>controls/lighting/landing-light</property>
      <property>sim/rendering/als-secondary-lights/use-landing-light</property>
    </output>
  </filter>
  <filter>
    <type>gain</type>
    <input>
      <condition>
	<and>
	  <property>controls/lighting/landing-light-switch[1]</property>
	  <property>controls/electric/circuit-breakers/bus-right/cb-light-landing-right</property>
	  <greater-than>
	    <property>systems/electrical/outputs/bus/right</property>
	    <value>20</value>
	  </greater-than>
	</and>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/lighting/landing-light[1]</property>
      <property>sim/rendering/als-secondary-lights/use-alt-landing-light</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
	<and>
	  <property>controls/lighting/strobe-switch</property>
	  <property>controls/electric/circuit-breakers/bus-left/cb-light-strobe</property>
	  <greater-than>
	    <property>systems/electrical/outputs/bus/left</property>
	    <value>20</value>
	  </greater-than>
	</and>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/lighting/strobe</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
	<and>
	  <property>controls/lighting/nav-lights-switch</property>
	  <property>controls/electric/circuit-breakers/bus-left/cb-light-nav</property>
	  <greater-than>
	    <property>systems/electrical/outputs/bus/left</property>
	    <value>20</value>
	  </greater-than>
	</and>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/lighting/nav-lights</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
	<and>
	  <property>controls/lighting/recog-lights-switch</property>
	  <property>controls/electric/circuit-breakers/bus-left/cb-light-recog-left</property>
	  <greater-than>
	    <property>systems/electrical/outputs/bus/left</property>
	    <value>20</value>
	  </greater-than>
	</and>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/lighting/recog-light[0]</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
	<and>
	  <property>controls/lighting/recog-lights-switch</property>
	  <property>controls/electric/circuit-breakers/bus-right/cb-light-recog-right</property>
	  <greater-than>
	    <property>systems/electrical/outputs/bus/right</property>
	    <value>20</value>
	  </greater-than>
	</and>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/lighting/recog-light[1]</property>
    </output>
  </filter>



<!--
##########################
####  Electric panel  ####
##########################
  -->

  <filter>
    <type>exponential</type>
    <filter-time>0.5</filter-time>
    <input>
      <condition>
	<equals>
	  <property>controls/electric/voltage-sel</property>
	  <value>0</value>
	</equals>
      </condition>
      <property>systems/electrical/outputs/bus/battery</property>
    </input>
    <input>
      <condition>
	<equals>
	  <property>controls/electric/voltage-sel</property>
	  <value>-1</value>
	</equals>
      </condition>
      <property>engines/engine/amp-v</property>
    </input>
    <input>
      <condition>
	<equals>
	  <property>controls/electric/voltage-sel</property>
	  <value>1</value>
	</equals>
      </condition>
      <property>engines/engine[1]/amp-v</property>
    </input>
    <output>
      <property>controls/electric/voltage-display</property>
    </output>
    <min>10</min>
    <max>40</max>
  </filter>

  <!-- simplified to enable manual engine start for the moment -->
  <filter>
    <type>gain</type>
    <input>
      <condition>
        <or>
          <and>
            <not>
              <equals>
                <property>controls/fuel/tank/boost-pump-switch</property>
                <value>0</value>
              </equals>
            </not>
            <greater-than>
              <property>systems/electrical/outputs/bus/left</property>
              <value>20</value>
            </greater-than>
          </and>
          <property>controls/electric/engine[0]/starter-btn</property>
        </or>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/fuel/tank/boost-pump</property>
    </output>
  </filter>
  <filter>
    <type>gain</type>
    <input>
      <condition>
        <or>
          <and>
            <not>
              <equals>
                <property>controls/fuel/tank[1]/boost-pump-switch</property>
                <value>0</value>
              </equals>
            </not>
            <greater-than>
              <property>systems/electrical/outputs/bus/right</property>
              <value>20</value>
            </greater-than>
          </and>
          <property>controls/electric/engine[1]/starter-btn</property>
        </or>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/fuel/tank[1]/boost-pump</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
        <or>
          <less-than>
            <property>systems/electrical/outputs/bus/left</property>
            <value>20</value>
          </less-than>
          <not><property>controls/electric/circuit-breakers/bus-left/cb-bus-left-starter</property></not>
        </or>
      </condition>
      <value>0</value>
    </input>
    <input>
      <property>controls/electric/engine[0]/starter-btn</property>
    </input>
    <output>
      <property>controls/electric/engine[0]/starter-btn</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
        <and>
          <greater-than>
            <property>systems/electrical/outputs/bus/left</property>
            <value>20</value>
          </greater-than>
          <property>controls/electric/circuit-breakers/bus-left/cb-bus-left-starter</property>
          <property>controls/electric/engine[0]/starter-btn</property>
        </and>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/engines/engine[0]/starter</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
        <or>
          <less-than>
            <property>systems/electrical/outputs/bus/right</property>
            <value>20</value>
          </less-than>
          <not><property>controls/electric/circuit-breakers/bus-right/cb-bus-right-starter</property></not>
        </or>
      </condition>
      <value>0</value>
    </input>
    <input>
      <property>controls/electric/engine[1]/starter-btn</property>
    </input>
    <output>
      <property>controls/electric/engine[1]/starter-btn</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
        <and>
          <greater-than>
            <property>systems/electrical/outputs/bus/right</property>
            <value>20</value>
          </greater-than>
          <property>controls/electric/circuit-breakers/bus-right/cb-bus-right-starter</property>
          <property>controls/electric/engine[1]/starter-btn</property>
        </and>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/engines/engine[1]/starter</property>
    </output>
  </filter>

<!--
###########################
####  Flight Controls  ####
###########################
  -->

  <filter>
    <type>gain</type>
    <input>
      <condition>
        <greater-than>
          <property>gear/gear[1]/compression-norm</property>
          <value>0.1</value>
        </greater-than>
      </condition>
      <value>1</value>
    </input>
    <output>
      <property>controls/electric/maingear-switch</property>
    </output>
  </filter>

  <filter>
    <type>gain</type>
    <input>
      <condition>
        <property>controls/electric/circuit-breakers/bus-left/cb-sys-speed-brake</property>
        <greater-than>
          <property>systems/electrical/outputs/bus/left</property>
          <value>20</value>
        </greater-than>
      </condition>
      <property>controls/flight/speedbrake-switch</property>
    </input>
    <output>
      <property>controls/flight/speedbrake</property>
    </output>
  </filter>

</PropertyList>
